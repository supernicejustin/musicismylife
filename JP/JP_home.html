<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>„Éõ„Éº„É†</title>
  <link rel="icon" href="../media/etc/IMG_2701.JPG">
  <style>
    @import url(../style/STYLE_Home.css);
    @import url(../style/STYLE_sidebar.css);
    @import url(../style/STYLE_Chatbot.css);
  </style>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
  </style>
</head>

<body>

  <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
  </script>

  <div class="sidebar">
    <div class="logo">
      <a href="JP_home.html"><img src="../media/etc/IMG_2701.JPG" alt="Logo" style="max-height: 130px;"></a><a href=""><img src="../media/etc/Design.png" alt="Logo" style="max-height: 75px; margin-bottom: 30px;"></a> <!-- ÏûëÍ≥° ÌååÌä∏Î°ú Ïù¥ÎèôÌïòÍ∏∞ ÏúÑÌïú Î°úÍ≥† (Î°úÍ≥† Î≥ÄÍ≤Ω Í∞ÄÎä•, Ï∂îÌõÑ ÏûëÍ≥°ÌååÌä∏ ÏôÑÏÑ± ÌõÑ Ïó∞Í≤∞) -->
    </div>
      <ul class="menu">
        <a href="JP_home.html"><li style="background-color: #222;">„Éõ„Éº„É†</li></a>
        <a href="JP_settings.html#general"><li>Ë®≠ÂÆö</li></a>
      </ul>
  </div>

  <div>
    <div style="padding-top: 30px;">
      <h1 style="margin: 0px 0px 30px 265px; display: inline;">„Éõ„Éº„É†</h1>
      <h4 style="float: right; margin-right: 30px; display: inline;">„É≠„Ç∞„Ç§„É≥</h4> <!-- Ïò§Î•∏Ï™Ω Ï†ïÎ†¨ (text-align ÏçºÎäîÎç∞ ÏïàÎêòÏÑú Îî¥Í±∞ ÏîÄ), ÎÑàÎ¨¥ Ïò§Î•∏Ï™ΩÏóê Î∂ôÏñ¥ÏÑú ÎßàÏßÑ Ï§å. Ï∂îÌõÑ Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÏôÄ Ïó∞Í≤∞-->
      <h4 style="float: right; margin-right: 20px; display: inline;">„Çµ„Ç§„É≥„Ç¢„ÉÉ„Éó</h4>
      <!-- h1, h4 Îëê ÌÉúÍ∑∏Îäî ÏõêÎûò Ï§ÑÎ∞îÍøàÏù¥ ÎêòÏßÄÎßå Í∞ôÏùÄ Ïó¥Ïóê ÏûàÏñ¥Ïïº ÌïòÎØÄÎ°ú display: inline; ÏÜçÏÑ± ÏÇ¨Ïö©Ìï®ÏúºÎ°úÏç® Í∞ôÏùÄ Ïó¥Ïóê ÌëúÏãú -->
    </div>
    <h2 style="margin: 0px 265px; padding-top: 60px;">„Åä„Åô„Åô„ÇÅ„ÅÆ„Ç¢„É´„Éê„É†</h2>
    <!-- ÏúÑÏ™ΩÍ≥º ÏïÑÎûòÏôÄ ÏôºÏ™Ω(ÏÇ¨Ïù¥ÎìúÎ∞î ÎÑìÏù¥Î≥¥Îã§ Îçî ÌÅ¨Í≤å) ÏïåÎßûÍ≤å ÎßàÏßÑÏùÑ Ï§å -->
  </div>

  <div class="content scrollbar"> <!-- content ÏÜçÏÑ±ÏúºÎ°ú Í≥µÍ∞ÑÏùÑ ÎßåÎì§Ïñ¥ Ï£ºÍ≥†, scrollbar ÏÜçÏÑ±ÏúºÎ°ú overflowÏÉÅÌô©ÏóêÏÑú Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§ Íµ¨ÌòÑ -->

    <!-- Ïï®Î≤î ÌëúÏãú Î∂ÄÎ¨∏ -->

    <div class="album">
      <a href="../Blank.html"><img src="../media/album/IMG_2027.JPG" alt="Album" class="albumart"></a>
      <div class="album-title">Lover</div>
      <div class="album-artist">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img src="../media/album/IMG_2029.JPG" alt="Album" class="albumart">
      <div class="album-title">AUSTIN</div>
      <div class="album-artist">Post Malone</div>
    </div>

    <div class="album">
      <img src="../media/album/IMG_2030.PNG" alt="Album" class="albumart">
      <div class="album-title">GUTS</div>
      <div class="album-artist">Oliva Rodrigo</div>
    </div>

    <div class="album">
      <img src="../media/album/IMG_2039.JPG" alt="Album" class="albumart">
      <div class="album-title">x (Deluxe Edition)</div>
      <div class="album-artist">Ed Sheeran</div>
    </div>
    
    <div class="album">
      <img src="../media/album/IMG_2049.JPG" alt="Album" class="albumart">
      <div class="album-title">Divinely Uninspired To A Hellish Extent</div>
      <div class="album-artist">Lewis Capaldi</div>
    </div>
    
    <div class="album">
      <img src="../media/album/IMG_2059.JPG" alt="Album" class="albumart">
      <div class="album-title">After Hours</div>
      <div class="album-artist">The Weeknd</div>
    </div>
        
    <div class="album">
      <img src="../media/album/IMG_2069.JPG" alt="Album" class="albumart">
      <div class="album-title">My Everything (Deluxe)</div>
      <div class="album-artist">Ariana Grande</div>
    </div>
    
    <div class="album">
      <img src="../media/album/IMG_2079.JPG" alt="Album" class="albumart">
      <div class="album-title">Future Nostalgia</div>
      <div class="album-artist">Dua Lipa</div>
    </div>
    
    <div class="album">
      <img src="../media/album/IMG_2089.JPG" alt="Album" class="albumart">
      <div class="album-title">Love Goes</div>
      <div class="album-artist">Sam Smith</div>
    </div>

    <!-- Îçî Ï∂îÍ∞Ä Í∞ÄÎä• -->

  </div>

  <div>
    <h2 style="margin: 0px 265px;">„Åä„Åô„Åô„ÇÅ„ÅÆ„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà</h2>
  </div>
  
  <div class="content scrollbar">

    <!-- ÏïÑÌã∞Ïä§Ìä∏ ÌëúÏãú Î∂ÄÎ¨∏ -->

    <div class="album"> <!-- Ïï®Î≤î ÌëúÏãú Îïå ÏÇ¨Ïö©ÌñàÎçò ÏÜçÏÑ± Ïû¨ÌôúÏö© -->
      <a href="../Blank.html"><img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile"></a> <!-- altÎÇ¥Ïö© Î≥ÄÍ≤ΩÌï® -->
      <div class="artist-name">Taylor Swift</div> <!-- artist-name ÏÜçÏÑ±ÏúºÎ°ú Î≥ÄÍ≤ΩÌï® -->
    </div>

    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>
    
    <div class="album">
      <img class="profile" src="../media/profile/unnamed.jpg" alt="Artist Profile">
      <div class="artist-name">Taylor Swift</div>
    </div>

    <!-- ÏßÄÍ∏àÏùÄ Taylor SwiftÎ°ú ÎèÑÎ∞∞ÌñàÏßÄÎßå Î≥ÄÍ≤ΩÌïòÎ©¥Îê® -->
    <!-- Îçî Ï∂îÍ∞Ä Í∞ÄÎä• -->

  </div>


  <!-- Ï±óÎ¥á html -->

  <button class="chatbot-toggler">
    <span class="material-symbols-rounded">mode_comment</span>
    <span class="material-symbols-outlined">close</span>
  </button>
  <div class="chatbot">
    <header>
      <h2>Chatbot</h2>
      <p>Powered by Gemini</p>
      <span class="close-btn material-symbols-outlined">close</span>
    </header>
    <ul class="chatbox">
      <li class="chat incoming">
        <span class="material-symbols-outlined">smart_toy</span>
        <p>„Åì„Çì„Å´„Å°„ÅØüëã<br>‰Ωï„Çí„ÅäÊâã‰ºù„ÅÑ„Åó„Åæ„Åó„Çá„ÅÜ„ÅãÔºü</p>
      </li>
    </ul>
    <div class="chat-input">
      <textarea placeholder="„É°„ÉÉ„Çª„Éº„Ç∏ÂÖ•Âäõ¬∑¬∑¬∑" spellcheck="false" required></textarea>
      <span id="send-btn" class="material-symbols-rounded">send</span>
    </div>
  </div>

  <!-- Ï±óÎ¥á Ïä§ÌÅ¨Î¶ΩÌä∏ -->
  <script type="module">
    import { GoogleGenerativeAI } from "@google/generative-ai";
    const genAI = new GoogleGenerativeAI('AIzaSyAUOyuSGwGGOp_YTo1xjLoXt6DgXw8jh7A');

    const chatbotToggler = document.querySelector(".chatbot-toggler");
    const closeBtn = document.querySelector(".close-btn");
    const chatbox = document.querySelector(".chatbox");
    const chatInput = document.querySelector(".chat-input textarea");
    const sendChatBtn = document.querySelector(".chat-input span");

    let userMessage = null;
    const inputInitHeight = chatInput.scrollHeight;

    async function runModel(prompt) {
        const model = genAI.getGenerativeModel({ model: "gemini-pro"});
      
        const result = await model.generateContent(prompt);
        const response = await result.response;
        const text = response.text();
        return (text);
      }
      

    const createChatLi = (message, className) => {
        const chatLi = document.createElement("li");
        chatLi.classList.add("chat", `${className}`);
        let chatContent = className === "outgoing" ? `<p></p>` : `<span class="material-symbols-outlined">smart_toy</span><p></p>`;
        chatLi.innerHTML = chatContent;
        chatLi.querySelector("p").textContent = message;
        return chatLi;
    }

    // Ï±óÎ¥á Ï∂úÎ†• Î∂ÄÎ∂Ñ
    const generateResponse = async (chatElement, userMessage) => {
        const messageElement = chatElement.querySelector("p");
        try {
            const answer = await runModel(userMessage);
            messageElement.textContent = answer;
            // Ïò§Î•ò Ï∂úÎ†•
        } catch (error) {
            console.error("ÂøúÁ≠î„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü;", error);
            messageElement.textContent = "„Åô„Åø„Åæ„Åõ„Çì„ÄÅ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ";
        }
        chatbox.scrollTo(0, chatbox.scrollHeight);
    }

    const handleChat = () => {
        userMessage = chatInput.value.trim(); // userMessage:ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÖÎ†•ÌïúÍ≤É --> valueÎ°ú
        // chatInput: textareaÎ∂ÄÎ∂Ñ
        if(!userMessage) return; // Í≥µÎ∞±Ïãú return
        
        // ÏûÖÎ†•Îêú textareaÎ•º ÏßÄÏö∞Í≥† ÎÜíÏù¥Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú ÏÑ§Ï†ï
        chatInput.value = "";
        chatInput.style.height = `${inputInitHeight}px`;

        // ÏûÖÎ†•Ìïú Î©îÏãúÏßÄÎ•º ÎåÄÌôî ÏÉÅÏûêÏóê Ï∂îÍ∞Ä
        chatbox.appendChild(createChatLi(userMessage, "outgoing"));
        chatbox.scrollTo(0, chatbox.scrollHeight);

        setTimeout(() => {
            // ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¨Îäî ÎèôÏïà "Thinking..." Î©îÏãúÏßÄ ÌëúÏãú
            const incomingChatLi = createChatLi("ËÄÉ„Åà‰∏≠¬∑¬∑¬∑", "incoming");
            chatbox.appendChild(incomingChatLi);
            chatbox.scrollTo(0, chatbox.scrollHeight);
            generateResponse(incomingChatLi, userMessage);
        }, 600);
    }

    chatInput.addEventListener("input", () => {
        // ÎÇ¥Ïö© Í∏∏Ïù¥Ïóê Îî∞Îùº ÏûÖÎ†•Îêú textareaÏùò ÎÜíÏù¥Î•º Ï°∞Ï†ï
        chatInput.style.height = `${inputInitHeight}px`;
        chatInput.style.height = `${chatInput.scrollHeight}px`;
    });

    chatInput.addEventListener("keydown", (e) => {
        // Shift ÌÇ§ÏôÄ ÏúàÎèÑÏö∞ÌÇ§Î•º ÎàÑÎ•¥ÏßÄ ÏïäÏùÄ Ï±ÑÎ°ú Enter ÌÇ§Î•º ÎàÑÎ•∏ Í≤ΩÏö∞ÏóêÎßå Ï±ÑÌåÖ Ï≤òÎ¶¨
        // Ï∞Ω ÎÑàÎπÑÍ∞Ä 800 pxÎ≥¥Îã§ ÌÅ∞ Í≤ΩÏö∞ÏóêÎßå Ï±ÑÌåÖ Ï≤òÎ¶¨
        if(e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
            e.preventDefault();
            handleChat();
        }
    });

    sendChatBtn.addEventListener("click", handleChat);
    closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
    chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));

  </script>

</body>

</html>

