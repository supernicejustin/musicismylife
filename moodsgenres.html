<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>SSS - Search</title>
  <link rel="icon" href="media/etc/IMG_2701-removebg-preview.png">
  <style>
    @import url(style/STYLE_LIbrary.css);
    @import url(style/STYLE_sidebar.css);
    @import url(style/STYLE_Chatbot.css);
  </style>
  <link rel="stylesheet"href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0">
  <link rel="stylesheet"href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>

  <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
  </script>

  <div class="sidebar">
    <div class="logo">
      <a href="home.html"><img src="media/etc/IMG_2701.JPG" alt="Logo" style="max-height: 130px;"></a><a href="composemain.html"><img src="media/etc/Design.png" alt="Logo" style="max-height: 75px; margin-bottom: 30px;"></a>
      <!-- ì‘ê³¡ íŒŒíŠ¸ë¡œ ì´ë™í•˜ê¸° ìœ„í•œ ë¡œê³  (ë¡œê³  ë³€ê²½ ê°€ëŠ¥, ì¶”í›„ ì‘ê³¡íŒŒíŠ¸ ì™„ì„± í›„ ì—°ê²°) -->
    </div>
    <ul class="menu">
      <a href="home.html"><li><i class="fas fa-home"></i>Home</li></a>
      <a href="./searchtab.html"><li style="background-color: #222;"><i class="fas fa-search"></i>Search</li></a>
      <a href="./library.html#downloads"><li><i class="fas fa-book"></i>Library</li></a>
      <a href="settings.html#general"><li><i class="fas fa-cog"></i>Settings</li></a>
    </ul>
    <footer>Â© 2024 SoundSeaStudio</footer>
  </div>

  <div>
    <div style="padding-top: 30px;">
      <h1 style="margin: 0px 0px 30px 265px; display: inline;">Pop</h1>
      <h4 style="float: right; margin-right: 30px; display: inline;"><a href="login.html">Log in</a></h4>
      <!-- ì˜¤ë¥¸ìª½ ì •ë ¬ (text-align ì¼ëŠ”ë° ì•ˆë˜ì„œ ë”´ê±° ì”€), ë„ˆë¬´ ì˜¤ë¥¸ìª½ì— ë¶™ì–´ì„œ ë§ˆì§„ ì¤Œ. ì¶”í›„ ë¡œê·¸ì¸ í˜ì´ì§€ì™€ ì—°ê²°-->
      <h4 style="float: right; margin-right: 20px; display: inline;"><a href="signup.html">Sign up</a></h4>
      <!-- h1, h4 ë‘ íƒœê·¸ëŠ” ì›ë˜ ì¤„ë°”ê¿ˆì´ ë˜ì§€ë§Œ ê°™ì€ ì—´ì— ìˆì–´ì•¼ í•˜ë¯€ë¡œ display: inline; ì†ì„± ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ê°™ì€ ì—´ì— í‘œì‹œ -->
    </div>
    <!-- ìœ„ìª½ê³¼ ì•„ë˜ì™€ ì™¼ìª½(ì‚¬ì´ë“œë°” ë„“ì´ë³´ë‹¤ ë” í¬ê²Œ) ì•Œë§ê²Œ ë§ˆì§„ì„ ì¤Œ -->
  </div>
  <div class="ssidebar">
    <!-- ì„ íƒì‹œ ê° ë¶€ë¶„ìœ¼ë¡œ ì´ë™í•˜ëŠ” ë©”ë‰´ë°” -->
    <ul>
      <li><a href="#familiar">
          <h3 style="margin: 50px 0px 0px 265px;">Discover</h3>
        </a></li>
        <li><a href="#familiar">
          <h3 style="margin: 50px 0px 0px 20px;">Familiar</h3>
        </a></li>
    </ul>
  </div>
  <div class="content" id="familiar">
    <!-- ë‹¤ìš´ë¡œë“œí•œ ìŒì•…ë“¤ -->
    <h2>Featured Albums</h2>
    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2027.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Lover</div></a>
      <a href="singer.html"><div class="album-artist">Taylor Swift</div></a>
    </div>
    
    <div class="album">
      <a href="album.html"><img src="media/album/1989.jpg" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">1989 (Taylor's Version)</div></a>
      <a href="singer.html"><div class="album-artist">Taylor Swift</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2039.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">x (Deluxe Edition)</div></a>
      <a href="singer.html"><div class="album-artist">Ed Sheeran</div></a>
    </div>
    
    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2029.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">AUSTIN</div></a>
      <a href="singer.html"><div class="album-artist">Post Malone</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2030.PNG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">GUTS</div></a>
      <a href="singer.html"><div class="album-artist">Oliva Rodrigo</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2049.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Divinely Uninspired To A Hellish Extent</div></a>
      <a href="singer.html"><div class="album-artist">Lewis Capaldi</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2069.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">My Everything (Deluxe)</div></a>
      <a href="singer.html"><div class="album-artist">Ariana Grande</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2059.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">After Hours</div></a>
      <a href="singer.html"><div class="album-artist">The Weeknd</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2079.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Future Nostalgia</div></a>
      <a href="singer.html"><div class="album-artist">Dua Lipa</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/IMG_2089.JPG" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Love Goes</div></a>
      <a href="singer.html"><div class="album-artist">Sam Smith</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/Midnights (3am Edition).jpg" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Midnights (3am Edition)</div></a>
      <a href="singer.html"><div class="album-artist">Taylor Swift</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/Fearless (Platinum Edition).jpg" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Fearless : The Kissing In The Rain Chapter</div></a>
      <a href="singer.html"><div class="album-artist">Taylor Swift</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/Speak Now (Taylor's Version).jpg" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Speak Now (Taylor's Version)</div></a>
      <a href="singer.html"><div class="album-artist">Taylor Swift</div></a>
    </div>

    <div class="album">
      <a href="album.html"><img src="media/album/Shake It Off.jpg" alt="Album" class="albumart"></a>
      <a href="album.html"><div class="album-title">Shake It Off</div></a>
      <a href="singer.html"><div class="album-artist">Taylor Swift</div></a>
    </div>

  <!-- ì±—ë´‡ html -->

  <button class="chatbot-toggler">
    <span class="material-symbols-rounded" style="margin-left: 8px;">mode_comment</span>
    <h4 style="margin-left: 40px;">Assistant</h4>
    <span class="material-symbols-outlined">close</span>
  </button>
  <div class="chatbot">
    <a href="easteregg.html">
      <header>
        <h2>Assistant</h2>
        <p>Powered by Gemini</p>
        <span class="close-btn material-symbols-outlined">close</span>
      </header>
    </a>
    <a href="easteregg.html">
      <ul class="chatbox">
        <li class="chat incoming">
          <span class="material-symbols-outlined">smart_toy</span>
          <p>Hi there ğŸ‘‹<br>How can I help you today?</p>
        </li>
      </ul>
    </a>
    <div class="chat-input">
      <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
      <span id="send-btn" class="material-symbols-rounded">send</span>
    </div>
  </div>

  <!-- ì±—ë´‡ ìŠ¤í¬ë¦½íŠ¸ -->
  <script type="module">
    // Google Generative AI ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
    import { GoogleGenerativeAI } from "@google/generative-ai";
    
    // Generative AI ì´ˆê¸°í™” ë° API í‚¤ ì„¤ì •
    const genAI = new GoogleGenerativeAI('AIzaSyAUOyuSGwGGOp_YTo1xjLoXt6DgXw8jh7A');

    // ì±—ë´‡ ê¸°ëŠ¥ì— í•„ìš”í•œ DOM ìš”ì†Œ ì„ íƒ
    const chatbotToggler = document.querySelector(".chatbot-toggler"); // ì±—ë´‡ í† ê¸€ ë²„íŠ¼
    const closeBtn = document.querySelector(".close-btn"); // ì±—ë´‡ ë‹«ê¸° ë²„íŠ¼
    const chatbox = document.querySelector(".chatbox"); // ì±„íŒ… ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ëŠ” ì˜ì—­
    const chatInput = document.querySelector(".chat-input textarea"); // ì‚¬ìš©ì ì…ë ¥ë€
    const sendChatBtn = document.querySelector(".chat-input span"); // ë©”ì‹œì§€ ì „ì†¡ ë²„íŠ¼

    // ì‚¬ìš©ì ë©”ì‹œì§€ ì €ì¥ ë³€ìˆ˜ ë° ì…ë ¥ë€ ì´ˆê¸° ë†’ì´ ì €ì¥
    let userMessage = null;
    const inputInitHeight = chatInput.scrollHeight;

    // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€ë¡œ ëª¨ë¸ ì‹¤í–‰
    async function runModel(prompt) {
        const model = genAI.getGenerativeModel({ model: "gemini-pro"}); // ëª¨ë¸ ê°€ì ¸ì˜¤ê¸°
      
        // ì‚¬ìš©ì ë©”ì‹œì§€ë¡œ ì½˜í…ì¸  ìƒì„±
        const result = await model.generateContent(prompt);
        const response = await result.response;
        const text = response.text();
        return (text); // ìƒì„±ëœ í…ìŠ¤íŠ¸ ë°˜í™˜
    }
    
    // ì±„íŒ… ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸ í•­ëª© ìƒì„±
    const createChatLi = (message, className) => {
        const chatLi = document.createElement("li"); // ìƒˆë¡œìš´ ë¦¬ìŠ¤íŠ¸ í•­ëª© ìƒì„±
        chatLi.classList.add("chat", `${className}`); // í´ë˜ìŠ¤ ì¶”ê°€
        // ë©”ì‹œì§€ íƒ€ì…ì— ë”°ë¼ ë‚´ìš© ì„¤ì •
        let chatContent = className === "outgoing" ? `<p></p>` : `<span class="material-symbols-outlined">smart_toy</span><p></p>`;
        chatLi.innerHTML = chatContent; // HTML ì„¤ì •
        chatLi.querySelector("p").textContent = message; // ë©”ì‹œì§€ ë‚´ìš© ì„¤ì •
        return chatLi; // ë¦¬ìŠ¤íŠ¸ í•­ëª© ë°˜í™˜
    }

    // ì±—ë´‡ ì‘ë‹µ ìƒì„±
    const generateResponse = async (chatElement, userMessage) => {
        const messageElement = chatElement.querySelector("p");
        try {
            const answer = await runModel(userMessage); // ëª¨ë¸ ì‹¤í–‰í•˜ì—¬ ì‘ë‹µ ìƒì„±
            messageElement.textContent = answer; // ì‘ë‹µ ë‚´ìš© ì„¤ì •
        } catch (error) {
            // ì˜¤ë¥˜ ì²˜ë¦¬
            console.error("Failed to generate response;", error);
            messageElement.textContent = "Sorry, something went wrong."; // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        }
        chatbox.scrollTo(0, chatbox.scrollHeight); // ì±„íŒ… ë°•ìŠ¤ë¥¼ ìµœì‹  ë©”ì‹œì§€ë¡œ ìŠ¤í¬ë¡¤
    }

    // ì±„íŒ… ì²˜ë¦¬
    const handleChat = () => {
        userMessage = chatInput.value.trim(); // ì‚¬ìš©ì ì…ë ¥ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
        if(!userMessage) return; // ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆìœ¼ë©´ ë°˜í™˜
        
        // ì…ë ¥ë€ ì´ˆê¸°í™” ë° ë†’ì´ ì¬ì„¤ì •
        chatInput.value = "";
        chatInput.style.height = `${inputInitHeight}px`;

        // ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ì±„íŒ… ë°•ìŠ¤ì— ì¶”ê°€
        chatbox.appendChild(createChatLi(userMessage, "outgoing"));
        chatbox.scrollTo(0, chatbox.scrollHeight);

        setTimeout(() => {
            // ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ "Thinking..." ë©”ì‹œì§€ í‘œì‹œ
            const incomingChatLi = createChatLi("Thinking...", "incoming");
            chatbox.appendChild(incomingChatLi);
            chatbox.scrollTo(0, chatbox.scrollHeight);
            generateResponse(incomingChatLi, userMessage); // ì‘ë‹µ ìƒì„± í•¨ìˆ˜ í˜¸ì¶œ
        }, 0); // ì‘ë‹µ ìƒì„± ì§€ì—°ì‹œê°„ ì„¤ì •
    }

    // ì…ë ¥ë€ ë‚´ìš© ê¸¸ì´ì— ë”°ë¼ ë†’ì´ ì¡°ì ˆ
    chatInput.addEventListener("input", () => {
        chatInput.style.height = `${inputInitHeight}px`; // ì´ˆê¸° ë†’ì´ë¡œ ì¬ì„¤ì •
        chatInput.style.height = `${chatInput.scrollHeight}px`; // ìƒˆë¡œìš´ ë‚´ìš©ì— ë§ê²Œ ë†’ì´ ì¡°ì ˆ
    });

    // Enter í‚¤ë¥¼ ëˆŒëŸ¬ ì±„íŒ… ì²˜ë¦¬
    chatInput.addEventListener("keydown", (e) => {
        if(e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) { // Shift í‚¤ë¥¼ ëˆ„ë¥´ì§€ ì•Šê³  Enter í‚¤ë¥¼ ëˆŒë €ìœ¼ë©° ì°½ ë„ˆë¹„ê°€ 800px ì´ìƒì¸ ê²½ìš°
            e.preventDefault(); // ê¸°ë³¸ Enter í‚¤ ë™ì‘ ë°©ì§€
            handleChat(); // ì±„íŒ… ì²˜ë¦¬ í•¨ìˆ˜ í˜¸ì¶œ
        }
    });

    // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì‹œ ì±„íŒ… ì²˜ë¦¬
    sendChatBtn.addEventListener("click", handleChat);

    // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì±—ë´‡ ë‹«ê¸°
    closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));

    // í† ê¸€ ë²„íŠ¼ í´ë¦­ ì‹œ ì±—ë´‡ í‘œì‹œ/ìˆ¨ê¸°ê¸° í† ê¸€
    chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));

</script>


</body>

</html>